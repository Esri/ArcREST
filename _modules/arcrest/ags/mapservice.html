<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>arcrest.ags.mapservice &mdash; ArcREST 3.5.4 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '3.5.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="ArcREST 3.5.4 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">ArcREST 3.5.4 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for arcrest.ags.mapservice</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">from</span> <span class="nn">.._abstract.abstract</span> <span class="kn">import</span> <span class="n">BaseAGSServer</span><span class="p">,</span> <span class="n">DynamicData</span><span class="p">,</span> <span class="n">BaseSecurityHandler</span>
<span class="kn">from</span> <span class="nn">.layer</span> <span class="kn">import</span> <span class="n">FeatureLayer</span><span class="p">,</span> <span class="n">TableLayer</span><span class="p">,</span> <span class="n">RasterLayer</span><span class="p">,</span> <span class="n">GroupLayer</span><span class="p">,</span> <span class="n">SchematicsLayer</span>
<span class="kn">from</span> <span class="nn">._schematicsservice</span> <span class="kn">import</span> <span class="n">SchematicsService</span>
<span class="kn">from</span> <span class="nn">._geoprocessing</span> <span class="kn">import</span> <span class="n">GPJob</span>
<span class="kn">from</span> <span class="nn">..security</span> <span class="kn">import</span> <span class="n">security</span>
<span class="kn">from</span> <span class="nn">..common</span> <span class="kn">import</span> <span class="n">filters</span><span class="p">,</span> <span class="n">geometry</span>
<span class="kn">from</span> <span class="nn">..common.geometry</span> <span class="kn">import</span> <span class="n">Polygon</span><span class="p">,</span> <span class="n">Envelope</span><span class="p">,</span> <span class="n">SpatialReference</span>
<span class="kn">from</span> <span class="nn">..common.general</span> <span class="kn">import</span> <span class="n">Feature</span>
<span class="kn">from</span> <span class="nn">..packages.six.moves.urllib_parse</span> <span class="kn">import</span> <span class="n">urlencode</span>
<span class="c1">########################################################################</span>
<div class="viewcode-block" id="MapService"><a class="viewcode-back" href="../../../arcrest.ags.html#arcrest.ags.mapservice.MapService">[docs]</a><span class="k">class</span> <span class="nc">MapService</span><span class="p">(</span><span class="n">BaseAGSServer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; contains information about a map service &quot;&quot;&quot;</span>
    <span class="n">_json</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_json_dict</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_tileInfo</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_url</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_username</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_password</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_token</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_token_url</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_currentVersion</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_serviceDescription</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_mapName</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_copyrightText</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_supportsDynamicLayers</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_layers</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_tables</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_spatialReference</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_singleFusedMapCache</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_initialExtent</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_fullExtent</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_minScale</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_maxScale</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_units</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_supportedImageFormatTypes</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_documentInfo</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_capabilities</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_supportedQueryFormats</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_exportTilesAllowed</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_maxRecordCount</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_maxImageHeight</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_maxImageWidth</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_supportedExtensions</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_timeInfo</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_maxExportTilesCount</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_hasVersionedData</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_securityHandler</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_proxy_url</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_proxy_port</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">_tileServers</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">securityHandler</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">initialize</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">proxy_url</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">proxy_port</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_proxy_url</span><span class="o">=</span> <span class="n">proxy_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_proxy_port</span> <span class="o">=</span> <span class="n">proxy_port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_url</span> <span class="o">=</span> <span class="n">url</span>
        <span class="k">if</span> <span class="n">securityHandler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> \
           <span class="nb">isinstance</span><span class="p">(</span><span class="n">securityHandler</span><span class="p">,</span> <span class="p">(</span><span class="n">security</span><span class="o">.</span><span class="n">AGSTokenSecurityHandler</span><span class="p">,</span>
                                        <span class="n">security</span><span class="o">.</span><span class="n">PortalServerSecurityHandler</span><span class="p">,</span>
                                        <span class="n">security</span><span class="o">.</span><span class="n">ArcGISTokenSecurityHandler</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_securityHandler</span> <span class="o">=</span> <span class="n">securityHandler</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">securityHandler</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_referer_url</span> <span class="o">=</span> <span class="n">securityHandler</span><span class="o">.</span><span class="n">referer_url</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_token</span> <span class="o">=</span> <span class="n">securityHandler</span><span class="o">.</span><span class="n">token</span>
        <span class="k">elif</span> <span class="n">securityHandler</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Security Handler must type of security.AGSTokenSecurityHandler&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">initialize</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">itemInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;gets the item&#39;s info&quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;f&quot;</span> <span class="p">:</span> <span class="s2">&quot;json&quot;</span>
        <span class="p">}</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url</span> <span class="o">+</span> <span class="s2">&quot;/info/iteminfo&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">param_dict</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
                            <span class="n">securityHandler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_securityHandler</span><span class="p">,</span>
                            <span class="n">proxy_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_url</span><span class="p">,</span>
                            <span class="n">proxy_port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_port</span><span class="p">)</span>
    <span class="c1">#----------------------------------------------------------------------</span>
<div class="viewcode-block" id="MapService.downloadThumbnail"><a class="viewcode-back" href="../../../arcrest.ags.html#arcrest.ags.mapservice.MapService.downloadThumbnail">[docs]</a>    <span class="k">def</span> <span class="nf">downloadThumbnail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outPath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;downloads the items&#39;s thumbnail&quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url</span> <span class="o">+</span> <span class="s2">&quot;/info/thumbnail&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>

        <span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
                            <span class="n">out_folder</span><span class="o">=</span><span class="n">outPath</span><span class="p">,</span>
                            <span class="n">file_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                            <span class="n">param_dict</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
                            <span class="n">securityHandler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_securityHandler</span><span class="p">,</span>
                            <span class="n">proxy_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_url</span><span class="p">,</span>
                            <span class="n">proxy_port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_port</span><span class="p">)</span></div>
    <span class="c1">#----------------------------------------------------------------------</span>
<div class="viewcode-block" id="MapService.downloadMetadataFile"><a class="viewcode-back" href="../../../arcrest.ags.html#arcrest.ags.mapservice.MapService.downloadMetadataFile">[docs]</a>    <span class="k">def</span> <span class="nf">downloadMetadataFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outPath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;downloads the metadata file to a given path&quot;&quot;&quot;</span>
        <span class="n">fileName</span> <span class="o">=</span> <span class="s2">&quot;metadata.xml&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url</span> <span class="o">+</span> <span class="s2">&quot;/info/metadata&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
                         <span class="n">out_folder</span><span class="o">=</span><span class="n">outPath</span><span class="p">,</span>
                         <span class="n">file_name</span><span class="o">=</span><span class="n">fileName</span><span class="p">,</span>
                         <span class="n">param_dict</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
                         <span class="n">securityHandler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_securityHandler</span><span class="p">,</span>
                         <span class="n">proxy_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_url</span><span class="p">,</span>
                         <span class="n">proxy_port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_port</span><span class="p">)</span></div>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;gets the object as as string&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_json</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_json</span>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">json_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;returns object as a dictionary&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_json_dict</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_json_dict</span>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">__init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; populates all the properties for the map service &quot;&quot;&quot;</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;f&quot;</span><span class="p">:</span> <span class="s2">&quot;json&quot;</span><span class="p">}</span>
        <span class="n">json_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_url</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span>
                                 <span class="n">securityHandler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_securityHandler</span><span class="p">,</span>
                                 <span class="n">proxy_port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_port</span><span class="p">,</span>
                                 <span class="n">proxy_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_json_dict</span> <span class="o">=</span> <span class="n">json_dict</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span><span class="n">attr</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                      <span class="k">if</span> <span class="ow">not</span> <span class="n">attr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)</span> <span class="ow">and</span> \
                      <span class="ow">not</span> <span class="n">attr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">json_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;tables&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tables</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">tbl</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                    <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url</span> <span class="o">+</span> <span class="s2">&quot;/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">tbl</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_tables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">TableLayer</span><span class="p">(</span><span class="n">url</span><span class="p">,</span>
                                   <span class="n">securityHandler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_securityHandler</span><span class="p">,</span>
                                   <span class="n">proxy_port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_port</span><span class="p">,</span>
                                   <span class="n">proxy_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_url</span><span class="p">)</span>
                    <span class="p">)</span>
            <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;layers&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_layers</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">lyr</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                    <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url</span> <span class="o">+</span> <span class="s2">&quot;/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">lyr</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                    <span class="n">layer_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getLayerType</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">layer_type</span> <span class="o">==</span> <span class="s2">&quot;Feature Layer&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">FeatureLayer</span><span class="p">(</span><span class="n">url</span><span class="p">,</span>
                                         <span class="n">securityHandler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_securityHandler</span><span class="p">,</span>
                                         <span class="n">proxy_port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_port</span><span class="p">,</span>
                                         <span class="n">proxy_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_url</span><span class="p">)</span>
                        <span class="p">)</span>
                    <span class="k">elif</span> <span class="n">layer_type</span> <span class="o">==</span> <span class="s2">&quot;Raster Layer&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">RasterLayer</span><span class="p">(</span><span class="n">url</span><span class="p">,</span>
                                        <span class="n">securityHandler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_securityHandler</span><span class="p">,</span>
                                        <span class="n">proxy_port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_port</span><span class="p">,</span>
                                        <span class="n">proxy_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_url</span><span class="p">)</span>
                        <span class="p">)</span>
                    <span class="k">elif</span> <span class="n">layer_type</span> <span class="o">==</span> <span class="s2">&quot;Group Layer&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">GroupLayer</span><span class="p">(</span><span class="n">url</span><span class="p">,</span>
                                       <span class="n">securityHandler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_securityHandler</span><span class="p">,</span>
                                       <span class="n">proxy_port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_port</span><span class="p">,</span>
                                       <span class="n">proxy_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_url</span><span class="p">)</span>
                        <span class="p">)</span>
                    <span class="k">elif</span> <span class="n">layer_type</span> <span class="o">==</span> <span class="s2">&quot;Schematics Layer&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">SchematicsLayer</span><span class="p">(</span><span class="n">url</span><span class="p">,</span>
                                            <span class="n">securityHandler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_securityHandler</span><span class="p">,</span>
                                            <span class="n">proxy_port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_port</span><span class="p">,</span>
                                            <span class="n">proxy_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_url</span><span class="p">)</span>
                        <span class="p">)</span>    
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">print</span> <span class="p">(</span><span class="s1">&#39;Type </span><span class="si">%s</span><span class="s1"> is not implemented&#39;</span> <span class="o">%</span> <span class="n">layer_type</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="o">+</span> <span class="n">k</span><span class="p">,</span> <span class="n">json_dict</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s2">&quot; is not implemented for mapservice.&quot;</span><span class="p">)</span>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;returns the JSON response in key/value pairs&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_json_dict</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_json_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">yield</span> <span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">]</span>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tileServers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; gets the tileServers for the service&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tileServers</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tileServers</span>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">securityHandler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; gets the security handler &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_securityHandler</span>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="nd">@securityHandler.setter</span>
    <span class="k">def</span> <span class="nf">securityHandler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sets the security handler &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">BaseSecurityHandler</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">security</span><span class="o">.</span><span class="n">AGSTokenSecurityHandler</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_securityHandler</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_securityHandler</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">maxExportTilesCount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns the maximum export tiles count &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maxExportTilesCount</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maxExportTilesCount</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">hasVersionedData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; reutrn boolean if has versioned data &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hasVersionedData</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hasVersionedData</span>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tileInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns tile info for cached services &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tileInfo</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tileInfo</span>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">currentVersion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns the map service current version &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currentVersion</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currentVersion</span>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">serviceDescription</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns the serviceDescription of the map service &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_serviceDescription</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_serviceDescription</span>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mapName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns the map name value &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapName</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapName</span>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns the map service description &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_description</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_description</span>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">copyrightText</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns the copyright text &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copyrightText</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copyrightText</span>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">supportsDynamicLayers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns boolean (True/False) if it support dynamic layers&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_supportsDynamicLayers</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_supportsDynamicLayers</span>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">layers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns all the layers in the map service &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_layers</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_layers</span>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns all tables in the map service &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tables</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tables</span>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">spatialReference</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns the spatialreference information for the map service &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spatialReference</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spatialReference</span>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">singleFusedMapCache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns boolean for this property &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_singleFusedMapCache</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_singleFusedMapCache</span>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">initialExtent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns the initial extent of the map service &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialExtent</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialExtent</span>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fullExtent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns the full extent of the map service &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fullExtent</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fullExtent</span>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">minScale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns the map service minimum scale &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minScale</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minScale</span>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">maxScale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns the max scale for a map service &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maxScale</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maxScale</span>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">units</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns the map service&#39;s measurement units &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">supportedImageFormatTypes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns the supported image format types &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_supportedImageFormatTypes</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_supportedImageFormatTypes</span>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">timeInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns the timeInformation for a given service &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timeInfo</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timeInfo</span>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">documentInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns the document information as a dictionary &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_documentInfo</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_documentInfo</span>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">capabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns the service&#39;s capabilities &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_capabilities</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_capabilities</span>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">supportedQueryFormats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns the supported query formats &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_supportedQueryFormats</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_supportedQueryFormats</span>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">exportTilesAllowed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Boolean if export tiles is allowed &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exportTilesAllowed</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exportTilesAllowed</span>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">maxRecordCount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns the max number of records returned by a query/display ect. &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maxRecordCount</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maxRecordCount</span>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">maxImageHeight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns the max image height &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maxImageHeight</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maxImageHeight</span>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">maxImageWidth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns the max image width &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maxImageWidth</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maxImageWidth</span>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">supportedExtensions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns the supported extensions &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_supportedExtensions</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_supportedExtensions</span>
    <span class="c1">#----------------------------------------------------------------------</span>
<div class="viewcode-block" id="MapService.getExtensions"><a class="viewcode-back" href="../../../arcrest.ags.html#arcrest.ags.mapservice.MapService.getExtensions">[docs]</a>    <span class="k">def</span> <span class="nf">getExtensions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;returns objects for all map service extensions&quot;&quot;&quot;</span>
        <span class="n">extensions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">supportedExtensions</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">supportedExtensions</span><span class="p">:</span>
                <span class="n">extensionURL</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url</span> <span class="o">+</span> <span class="s2">&quot;/exts/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ext</span>
                <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s2">&quot;SchematicsServer&quot;</span><span class="p">:</span>
                    <span class="n">extensions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SchematicsService</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">extensionURL</span><span class="p">,</span>
                                                        <span class="n">securityHandler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_securityHandler</span><span class="p">,</span>
                                                        <span class="n">proxy_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_url</span><span class="p">,</span>
                                                        <span class="n">proxy_port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_port</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">extensions</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">extensionURL</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url</span> <span class="o">+</span> <span class="s2">&quot;/exts/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">supportedExtensions</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">supportedExtensions</span> <span class="o">==</span> <span class="s2">&quot;SchematicsServer&quot;</span><span class="p">:</span>
                <span class="n">extensions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SchematicsService</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">extensionURL</span><span class="p">,</span>
                                                    <span class="n">securityHandler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_securityHandler</span><span class="p">,</span>
                                                    <span class="n">proxy_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_url</span><span class="p">,</span>
                                                    <span class="n">proxy_port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_port</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">extensions</span></div>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">allLayers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns all layers for the service &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url</span> <span class="o">+</span> <span class="s2">&quot;/layers&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;f&quot;</span> <span class="p">:</span> <span class="s2">&quot;json&quot;</span>
        <span class="p">}</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">param_dict</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
                           <span class="n">securityHandler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_securityHandler</span><span class="p">,</span>
                           <span class="n">proxy_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_url</span><span class="p">,</span>
                           <span class="n">proxy_port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_port</span><span class="p">)</span>
        <span class="n">return_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;layers&quot;</span> <span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;tables&quot;</span> <span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;layers&quot;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                    <span class="n">return_dict</span><span class="p">[</span><span class="s1">&#39;layers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">FeatureLayer</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_url</span> <span class="o">+</span> <span class="s2">&quot;/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">val</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
                                     <span class="n">securityHandler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_securityHandler</span><span class="p">,</span>
                                     <span class="n">proxy_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_url</span><span class="p">,</span>
                                     <span class="n">proxy_port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_port</span><span class="p">)</span>
                    <span class="p">)</span>
            <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;tables&quot;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                    <span class="n">return_dict</span><span class="p">[</span><span class="s1">&#39;tables&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">TableLayer</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_url</span> <span class="o">+</span> <span class="s2">&quot;/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">val</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
                                   <span class="n">securityHandler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_securityHandler</span><span class="p">,</span>
                                   <span class="n">proxy_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_url</span><span class="p">,</span>
                                   <span class="n">proxy_port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_port</span><span class="p">)</span>
                    <span class="p">)</span>
            <span class="k">del</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span>
        <span class="k">return</span> <span class="n">return_dict</span>
    <span class="c1">#----------------------------------------------------------------------</span>
<div class="viewcode-block" id="MapService.find"><a class="viewcode-back" href="../../../arcrest.ags.html#arcrest.ags.mapservice.MapService.find">[docs]</a>    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">searchText</span><span class="p">,</span> <span class="n">layers</span><span class="p">,</span>
             <span class="n">contains</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">searchFields</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
             <span class="n">sr</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">layerDefs</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
             <span class="n">returnGeometry</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">maxAllowableOffset</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
             <span class="n">geometryPrecision</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">dynamicLayers</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
             <span class="n">returnZ</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">returnM</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">gdbVersion</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; performs the map service find operation &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url</span> <span class="o">+</span> <span class="s2">&quot;/find&quot;</span>
        <span class="c1">#print url</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;f&quot;</span> <span class="p">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
            <span class="s2">&quot;searchText&quot;</span> <span class="p">:</span> <span class="n">searchText</span><span class="p">,</span>
            <span class="s2">&quot;contains&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_boolean</span><span class="p">(</span><span class="n">contains</span><span class="p">),</span>
            <span class="s2">&quot;searchFields&quot;</span><span class="p">:</span> <span class="n">searchFields</span><span class="p">,</span>
            <span class="s2">&quot;sr&quot;</span> <span class="p">:</span> <span class="n">sr</span><span class="p">,</span>
            <span class="s2">&quot;layerDefs&quot;</span> <span class="p">:</span> <span class="n">layerDefs</span><span class="p">,</span>
            <span class="s2">&quot;returnGeometry&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_boolean</span><span class="p">(</span><span class="n">returnGeometry</span><span class="p">),</span>
            <span class="s2">&quot;maxAllowableOffset&quot;</span> <span class="p">:</span> <span class="n">maxAllowableOffset</span><span class="p">,</span>
            <span class="s2">&quot;geometryPrecision&quot;</span> <span class="p">:</span> <span class="n">geometryPrecision</span><span class="p">,</span>
            <span class="s2">&quot;dynamicLayers&quot;</span> <span class="p">:</span> <span class="n">dynamicLayers</span><span class="p">,</span>
            <span class="s2">&quot;returnZ&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_boolean</span><span class="p">(</span><span class="n">returnZ</span><span class="p">),</span>
            <span class="s2">&quot;returnM&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_boolean</span><span class="p">(</span><span class="n">returnM</span><span class="p">),</span>
            <span class="s2">&quot;gdbVersion&quot;</span> <span class="p">:</span> <span class="n">gdbVersion</span><span class="p">,</span>
            <span class="s2">&quot;layers&quot;</span> <span class="p">:</span> <span class="n">layers</span>
        <span class="p">}</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span>
                           <span class="n">securityHandler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_securityHandler</span><span class="p">,</span>
                           <span class="n">proxy_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_url</span><span class="p">,</span>
                           <span class="n">proxy_port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_port</span><span class="p">)</span>
        <span class="n">qResults</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">]:</span>
            <span class="n">qResults</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Feature</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">qResults</span></div>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">_getLayerType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns a layer type &quot;&quot;&quot;</span>
        <span class="n">params</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;f&quot;</span> <span class="p">:</span> <span class="s2">&quot;json&quot;</span>
        <span class="p">}</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">param_dict</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
                           <span class="n">securityHandler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_securityHandler</span><span class="p">,</span>
                           <span class="n">proxy_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_url</span><span class="p">,</span>
                           <span class="n">proxy_port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_port</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
    <span class="c1">#----------------------------------------------------------------------</span>
<div class="viewcode-block" id="MapService.getFeatureDynamicLayer"><a class="viewcode-back" href="../../../arcrest.ags.html#arcrest.ags.mapservice.MapService.getFeatureDynamicLayer">[docs]</a>    <span class="k">def</span> <span class="nf">getFeatureDynamicLayer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oid</span><span class="p">,</span> <span class="n">dynamicLayer</span><span class="p">,</span>
                               <span class="n">returnZ</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">returnM</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The feature resource represents a single feature in a dynamic</span>
<span class="sd">            layer in a map service</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url</span> <span class="o">+</span> <span class="s2">&quot;/dynamicLayer/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">oid</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;f&quot;</span><span class="p">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
            <span class="s2">&quot;returnZ&quot;</span><span class="p">:</span> <span class="n">returnZ</span><span class="p">,</span>
            <span class="s2">&quot;returnM&quot;</span> <span class="p">:</span> <span class="n">returnM</span><span class="p">,</span>
            <span class="s2">&quot;layer&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">101</span><span class="p">,</span>
                <span class="s2">&quot;source&quot;</span> <span class="p">:</span> <span class="n">dynamicLayer</span><span class="o">.</span><span class="n">asDictionary</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">Feature</span><span class="p">(</span>
            <span class="n">json_string</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
                                     <span class="n">param_dict</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
                                     <span class="n">securityHandler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_securityHandler</span><span class="p">,</span>
                                     <span class="n">proxy_port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_port</span><span class="p">,</span>
                                     <span class="n">proxy_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_url</span><span class="p">)</span>
        <span class="p">)</span></div>
    <span class="c1">#----------------------------------------------------------------------</span>
<div class="viewcode-block" id="MapService.identify"><a class="viewcode-back" href="../../../arcrest.ags.html#arcrest.ags.mapservice.MapService.identify">[docs]</a>    <span class="k">def</span> <span class="nf">identify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">geometry</span><span class="p">,</span>
                 <span class="n">mapExtent</span><span class="p">,</span>
                 <span class="n">imageDisplay</span><span class="p">,</span>
                 <span class="n">tolerance</span><span class="p">,</span>
                 <span class="n">geometryType</span><span class="o">=</span><span class="s2">&quot;esriGeometryPoint&quot;</span><span class="p">,</span>
                 <span class="n">sr</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">layerDefs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">time</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">layerTimeOptions</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">layers</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span>
                 <span class="n">returnGeometry</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">maxAllowableOffset</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">geometryPrecision</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">dynamicLayers</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">returnZ</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">returnM</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">gdbVersion</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            The identify operation is performed on a map service resource</span>
<span class="sd">            to discover features at a geographic location. The result of this</span>
<span class="sd">            operation is an identify results resource. Each identified result</span>
<span class="sd">            includes its name, layer ID, layer name, geometry and geometry type,</span>
<span class="sd">            and other attributes of that result as name-value pairs.</span>

<span class="sd">            Inputs:</span>
<span class="sd">            geometry - The geometry to identify on. The type of the geometry is</span>
<span class="sd">                       specified by the geometryType parameter. The structure of</span>
<span class="sd">                       the geometries is same as the structure of the JSON geometry</span>
<span class="sd">                       objects returned by the ArcGIS REST API. In addition to the</span>
<span class="sd">                       JSON structures, for points and envelopes, you can specify</span>
<span class="sd">                       the geometries with a simpler comma-separated syntax.</span>
<span class="sd">                       Syntax:</span>
<span class="sd">                       JSON structures:</span>
<span class="sd">                       &lt;geometryType&gt;&amp;geometry={ geometry}</span>
<span class="sd">                       Point simple syntax:</span>
<span class="sd">                       esriGeometryPoint&amp;geometry=&lt;x&gt;,&lt;y&gt;</span>
<span class="sd">                       Envelope simple syntax:</span>
<span class="sd">                       esriGeometryEnvelope&amp;geometry=&lt;xmin&gt;,&lt;ymin&gt;,&lt;xmax&gt;,&lt;ymax&gt;</span>

<span class="sd">            geometryType - The type of geometry specified by the geometry parameter.</span>
<span class="sd">                           The geometry type could be a point, line, polygon, or</span>
<span class="sd">                           an envelope.</span>
<span class="sd">                           Values:</span>
<span class="sd">                           esriGeometryPoint | esriGeometryMultipoint |</span>
<span class="sd">                           esriGeometryPolyline | esriGeometryPolygon |</span>
<span class="sd">                           esriGeometryEnvelope</span>

<span class="sd">            sr - The well-known ID of the spatial reference of the input and</span>
<span class="sd">                 output geometries as well as the mapExtent. If sr is not specified,</span>
<span class="sd">                 the geometry and the mapExtent are assumed to be in the spatial</span>
<span class="sd">                 reference of the map, and the output geometries are also in the</span>
<span class="sd">                 spatial reference of the map.</span>

<span class="sd">            layerDefs - Allows you to filter the features of individual layers in</span>
<span class="sd">                        the exported map by specifying definition expressions for</span>
<span class="sd">                        those layers. Definition expression for a layer that is</span>
<span class="sd">                        published with the service will be always honored.</span>

<span class="sd">            time - The time instant or the time extent of the features to be</span>
<span class="sd">            identified.</span>

<span class="sd">            layerTimeOptions - The time options per layer. Users can indicate</span>
<span class="sd">                               whether or not the layer should use the time extent</span>
<span class="sd">                               specified by the time parameter or not, whether to</span>
<span class="sd">                               draw the layer features cumulatively or not and the</span>
<span class="sd">                               time offsets for the layer.</span>

<span class="sd">            layers - The layers to perform the identify operation on. There are</span>
<span class="sd">                     three ways to specify which layers to identify on:</span>
<span class="sd">                     top: Only the top-most layer at the specified location.</span>
<span class="sd">                     visible: All visible layers at the specified location.</span>
<span class="sd">                     all: All layers at the specified location.</span>

<span class="sd">            tolerance - The distance in screen pixels from the specified geometry</span>
<span class="sd">                        within which the identify should be performed. The value for</span>
<span class="sd">                        the tolerance is an integer.</span>

<span class="sd">            mapExtent - The extent or bounding box of the map currently being viewed.</span>
<span class="sd">                        Unless the sr parameter has been specified, the mapExtent is</span>
<span class="sd">                        assumed to be in the spatial reference of the map.</span>
<span class="sd">                        Syntax: &lt;xmin&gt;, &lt;ymin&gt;, &lt;xmax&gt;, &lt;ymax&gt;</span>
<span class="sd">                        The mapExtent and the imageDisplay parameters are used by the</span>
<span class="sd">                        server to determine the layers visible in the current extent.</span>
<span class="sd">                        They are also used to calculate the distance on the map to</span>
<span class="sd">                        search based on the tolerance in screen pixels.</span>

<span class="sd">            imageDisplay - The screen image display parameters (width, height, and DPI)</span>
<span class="sd">                           of the map being currently viewed. The mapExtent and the</span>
<span class="sd">                           imageDisplay parameters are used by the server to determine</span>
<span class="sd">                           the layers visible in the current extent. They are also used</span>
<span class="sd">                           to calculate the distance on the map to search based on the</span>
<span class="sd">                           tolerance in screen pixels.</span>
<span class="sd">                           Syntax: &lt;width&gt;, &lt;height&gt;, &lt;dpi&gt;</span>

<span class="sd">            returnGeometry - If true, the resultset will include the geometries</span>
<span class="sd">                             associated with each result. The default is true.</span>

<span class="sd">            maxAllowableOffset - This option can be used to specify the maximum allowable</span>
<span class="sd">                                 offset to be used for generalizing geometries returned by</span>
<span class="sd">                                 the identify operation. The maxAllowableOffset is in the units</span>
<span class="sd">                                 of the sr. If sr is not specified, maxAllowableOffset is</span>
<span class="sd">                                 assumed to be in the unit of the spatial reference of the map.</span>

<span class="sd">            geometryPrecision - This option can be used to specify the number of decimal places</span>
<span class="sd">                                in the response geometries returned by the identify operation.</span>
<span class="sd">                                This applies to X and Y values only (not m or z-values).</span>

<span class="sd">            dynamicLayers - Use dynamicLayers property to reorder layers and change the layer</span>
<span class="sd">                            data source. dynamicLayers can also be used to add new layer that</span>
<span class="sd">                            was not defined in the map used to create the map service. The new</span>
<span class="sd">                            layer should have its source pointing to one of the registered</span>
<span class="sd">                            workspaces that was defined at the time the map service was created.</span>
<span class="sd">                            The order of dynamicLayers array defines the layer drawing order.</span>
<span class="sd">                            The first element of the dynamicLayers is stacked on top of all</span>
<span class="sd">                            other layers. When defining a dynamic layer, source is required.</span>

<span class="sd">            returnZ - If true, Z values will be included in the results if the features have</span>
<span class="sd">                      Z values. Otherwise, Z values are not returned. The default is false.</span>
<span class="sd">                      This parameter only applies if returnGeometry=true.</span>

<span class="sd">            returnM - If true, M values will be included in the results if the features have</span>
<span class="sd">                      M values. Otherwise, M values are not returned. The default is false.</span>
<span class="sd">                      This parameter only applies if returnGeometry=true.</span>

<span class="sd">            gdbVersion - Switch map layers to point to an alternate geodatabase version.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">params</span><span class="o">=</span> <span class="p">{</span><span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="n">geometry</span><span class="p">,</span>
                 <span class="s1">&#39;geometryType&#39;</span><span class="p">:</span> <span class="n">geometryType</span><span class="p">,</span>
                 <span class="s1">&#39;tolerance&#39;</span><span class="p">:</span> <span class="n">tolerance</span><span class="p">,</span>
                 <span class="s1">&#39;mapExtent&#39;</span><span class="p">:</span> <span class="n">mapExtent</span><span class="p">,</span>
                 <span class="s1">&#39;imageDisplay&#39;</span><span class="p">:</span> <span class="n">imageDisplay</span>
                 <span class="p">}</span>

        <span class="k">if</span> <span class="n">layerDefs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;layerDefs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layerDefs</span>
        <span class="k">if</span> <span class="n">layers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;layers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layers</span>
        <span class="k">if</span> <span class="n">sr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;sr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sr</span>
        <span class="k">if</span> <span class="n">time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span>
        <span class="k">if</span> <span class="n">layerTimeOptions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;layerTimeOptions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layerTimeOptions</span>
        <span class="k">if</span> <span class="n">maxAllowableOffset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;maxAllowableOffset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxAllowableOffset</span>
        <span class="k">if</span> <span class="n">geometryPrecision</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;geometryPrecision&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geometryPrecision</span>
        <span class="k">if</span> <span class="n">dynamicLayers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;dynamicLayers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dynamicLayers</span>
        <span class="k">if</span> <span class="n">gdbVersion</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;gdbVersion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdbVersion</span>

        <span class="n">identifyURL</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url</span> <span class="o">+</span> <span class="s2">&quot;/identify&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">identifyURL</span><span class="p">,</span>
                            <span class="n">param_dict</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
                            <span class="n">securityHandler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_securityHandler</span><span class="p">,</span>
                            <span class="n">proxy_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_url</span><span class="p">,</span>
                            <span class="n">proxy_port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_port</span><span class="p">)</span></div>
    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">_convert_boolean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; converts a boolean value to json value &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;true&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;false&#39;</span>
    <span class="c1">#----------------------------------------------------------------------</span>
<div class="viewcode-block" id="MapService.generateKML"><a class="viewcode-back" href="../../../arcrest.ags.html#arcrest.ags.mapservice.MapService.generateKML">[docs]</a>    <span class="k">def</span> <span class="nf">generateKML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_location</span><span class="p">,</span> <span class="n">docName</span><span class="p">,</span> <span class="n">layers</span><span class="p">,</span> <span class="n">layerOptions</span><span class="o">=</span><span class="s2">&quot;composite&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">           The generateKml operation is performed on a map service resource.</span>
<span class="sd">           The result of this operation is a KML document wrapped in a KMZ</span>
<span class="sd">           file. The document contains a network link to the KML Service</span>
<span class="sd">           endpoint with properties and parameters you specify.</span>
<span class="sd">           Inputs:</span>
<span class="sd">              docName - The name of the resulting KML document. This is the</span>
<span class="sd">                        name that appears in the Places panel of Google</span>
<span class="sd">                        Earth.</span>
<span class="sd">              layers - the layers to perform the generateKML operation on.</span>
<span class="sd">                       The layers are specified as a comma-separated list</span>
<span class="sd">                       of layer ids.</span>
<span class="sd">              layerOptions - The layer drawing options. Based on the option</span>
<span class="sd">                             chosen, the layers are drawn as one composite</span>
<span class="sd">                             image, as separate images, or as vectors. When</span>
<span class="sd">                             the KML capability is enabled, the ArcGIS</span>
<span class="sd">                             Server administrator has the option of setting</span>
<span class="sd">                             the layer operations allowed. If vectors are</span>
<span class="sd">                             not allowed, then the caller will not be able</span>
<span class="sd">                             to get vectors. Instead, the caller receives a</span>
<span class="sd">                             single composite image.</span>
<span class="sd">                             values: composite | separateImage |</span>
<span class="sd">                                     nonComposite</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kmlURL</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url</span> <span class="o">+</span> <span class="s2">&quot;/generateKml&quot;</span>
        <span class="n">params</span><span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;f&quot;</span> <span class="p">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
            <span class="s1">&#39;docName&#39;</span> <span class="p">:</span> <span class="n">docName</span><span class="p">,</span>
            <span class="s1">&#39;layers&#39;</span> <span class="p">:</span> <span class="n">layers</span><span class="p">,</span>
            <span class="s1">&#39;layerOptions&#39;</span><span class="p">:</span> <span class="n">layerOptions</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">kmlURL</span><span class="p">,</span>
                         <span class="n">out_folder</span><span class="o">=</span><span class="n">save_location</span><span class="p">,</span>
                         <span class="n">param_dict</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
                         <span class="n">securityHandler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_securityHandler</span><span class="p">,</span>
                         <span class="n">proxy_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_url</span><span class="p">,</span>
                         <span class="n">proxy_port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_port</span>
                         <span class="p">)</span></div>
    <span class="c1">#----------------------------------------------------------------------</span>
<div class="viewcode-block" id="MapService.exportMap"><a class="viewcode-back" href="../../../arcrest.ags.html#arcrest.ags.mapservice.MapService.exportMap">[docs]</a>    <span class="k">def</span> <span class="nf">exportMap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                  <span class="n">bbox</span><span class="p">,</span>
                  <span class="n">size</span><span class="o">=</span><span class="s2">&quot;600,550&quot;</span><span class="p">,</span>
                  <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
                  <span class="n">imageSR</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                  <span class="n">image_format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">,</span>
                  <span class="n">layerDefFilter</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                  <span class="n">layers</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                  <span class="n">transparent</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                  <span class="n">timeFilter</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                  <span class="n">layerTimeOptions</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                  <span class="n">dynamicLayers</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                  <span class="n">mapScale</span><span class="o">=</span><span class="bp">None</span>
                  <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">           The export operation is performed on a map service resource.</span>
<span class="sd">           The result of this operation is a map image resource. This</span>
<span class="sd">           resource provides information about the exported map image such</span>
<span class="sd">           as its URL, its width and height, extent and scale.</span>
<span class="sd">           Inputs:</span>
<span class="sd">            bbox - envelope geometry object</span>
<span class="sd">            size - size of image in pixels</span>
<span class="sd">            dpi - dots per inch</span>
<span class="sd">            imageSR - spatial reference of the output image</span>
<span class="sd">            image_format - Description: The format of the exported image.</span>
<span class="sd">                             The default format is .png.</span>
<span class="sd">                             Values: png | png8 | png24 | jpg | pdf | bmp | gif</span>
<span class="sd">                                     | svg | svgz | emf | ps | png32</span>
<span class="sd">            layerDefFilter - Description: Allows you to filter the</span>
<span class="sd">                             features of individual layers in the exported</span>
<span class="sd">                             map by specifying definition expressions for</span>
<span class="sd">                             those layers. Definition expression for a</span>
<span class="sd">                             layer that is published with the service will</span>
<span class="sd">                             be always honored.</span>
<span class="sd">            layers - Determines which layers appear on the exported map.</span>
<span class="sd">                     There are four ways to specify which layers are shown:</span>
<span class="sd">                        show: Only the layers specified in this list will</span>
<span class="sd">                              be exported.</span>
<span class="sd">                        hide: All layers except those specified in this</span>
<span class="sd">                              list will be exported.</span>
<span class="sd">                        include: In addition to the layers exported by</span>
<span class="sd">                                 default, the layers specified in this list</span>
<span class="sd">                                 will be exported.</span>
<span class="sd">                        exclude: The layers exported by default excluding</span>
<span class="sd">                                 those specified in this list will be</span>
<span class="sd">                                 exported.</span>
<span class="sd">            transparent - If true, the image will be exported with the</span>
<span class="sd">                          background color of the map set as its</span>
<span class="sd">                          transparent color. The default is false. Only</span>
<span class="sd">                          the .png and .gif formats support transparency.</span>
<span class="sd">                          Internet Explorer 6 does not display transparency</span>
<span class="sd">                          correctly for png24 image formats.</span>
<span class="sd">            timeFilter - The time instant or time extent of the exported</span>
<span class="sd">                         map image.</span>
<span class="sd">            layerTimeOptions - The time options per layer. Users can</span>
<span class="sd">                               indicate whether or not the layer should use</span>
<span class="sd">                               the time extent specified by the time</span>
<span class="sd">                               parameter or not, whether to draw the layer</span>
<span class="sd">                               features cumulatively or not and the time</span>
<span class="sd">                               offsets for the layer.</span>
<span class="sd">                               see: http://resources.arcgis.com/en/help/arcgis-rest-api/index.html#/Export_Map/02r3000000v7000000/</span>
<span class="sd">            dynamicLayers - Use dynamicLayers parameter to modify the layer</span>
<span class="sd">                            drawing order, change layer drawing info, and</span>
<span class="sd">                            change layer data source version for this request.</span>
<span class="sd">                            New layers (dataLayer) can also be added to the</span>
<span class="sd">                            dynamicLayers based on the map service registered</span>
<span class="sd">                            workspaces.</span>
<span class="sd">            mapScale - Use this parameter to export a map image at a specific</span>
<span class="sd">                       scale, with the map centered around the center of the</span>
<span class="sd">                       specified bounding box (bbox).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;f&quot;</span> <span class="p">:</span> <span class="s2">&quot;json&quot;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">Envelope</span><span class="p">):</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">bbox</span><span class="o">.</span><span class="n">asDictionary</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;bbox&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="s1">&#39;xmin&#39;</span><span class="p">],</span> <span class="n">vals</span><span class="p">[</span><span class="s1">&#39;ymin&#39;</span><span class="p">],</span>
                                              <span class="n">vals</span><span class="p">[</span><span class="s1">&#39;xmax&#39;</span><span class="p">],</span> <span class="n">vals</span><span class="p">[</span><span class="s1">&#39;ymax&#39;</span><span class="p">])</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;bboxSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="s1">&#39;spatialReference&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">dpi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dpi</span>
            <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span>
            <span class="k">if</span> <span class="n">imageSR</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> \
               <span class="nb">isinstance</span><span class="p">(</span><span class="n">imageSR</span><span class="p">,</span> <span class="n">SpatialReference</span><span class="p">):</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;imageSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;wkid&#39;</span><span class="p">:</span> <span class="n">imageSR</span><span class="o">.</span><span class="n">wkid</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">image_format</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;format&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">image_format</span>
            <span class="k">if</span> <span class="n">layerDefFilter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> \
               <span class="nb">isinstance</span><span class="p">(</span><span class="n">layerDefFilter</span><span class="p">,</span>
                          <span class="n">filters</span><span class="o">.</span><span class="n">LayerDefinitionFilter</span><span class="p">):</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;layerDefs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layerDefFilter</span><span class="o">.</span><span class="n">filter</span>
            <span class="k">if</span> <span class="n">layers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;layers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layers</span>
            <span class="k">if</span> <span class="n">transparent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;transparent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transparent</span>
            <span class="k">if</span> <span class="n">timeFilter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> \
               <span class="nb">isinstance</span><span class="p">(</span><span class="n">timeFilter</span><span class="p">,</span> <span class="n">filters</span><span class="o">.</span><span class="n">TimeFilter</span><span class="p">):</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timeFilter</span><span class="o">.</span><span class="n">filter</span>
            <span class="k">if</span> <span class="n">layerTimeOptions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;layerTimeOptions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layerTimeOptions</span>
            <span class="k">if</span> <span class="n">dynamicLayers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> \
               <span class="nb">isinstance</span><span class="p">(</span><span class="n">dynamicLayers</span><span class="p">,</span> <span class="n">DynamicData</span><span class="p">):</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;dynamicLayers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dynamicLayers</span><span class="o">.</span><span class="n">asDictionary</span>
            <span class="k">if</span> <span class="n">mapScale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;mapScale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapScale</span>
            <span class="n">exportURL</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url</span> <span class="o">+</span> <span class="s2">&quot;/export&quot;</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">exportURL</span><span class="p">,</span>
                                <span class="n">param_dict</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
                                <span class="n">securityHandler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_securityHandler</span><span class="p">,</span>
                                <span class="n">proxy_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_url</span><span class="p">,</span>
                                <span class="n">proxy_port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_port</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span></div>
    <span class="c1">#----------------------------------------------------------------------</span>
<div class="viewcode-block" id="MapService.estimateExportTilesSize"><a class="viewcode-back" href="../../../arcrest.ags.html#arcrest.ags.mapservice.MapService.estimateExportTilesSize">[docs]</a>    <span class="k">def</span> <span class="nf">estimateExportTilesSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                <span class="n">exportBy</span><span class="p">,</span>
                                <span class="n">levels</span><span class="p">,</span>
                                <span class="n">tilePackage</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                <span class="n">exportExtent</span><span class="o">=</span><span class="s2">&quot;DEFAULTEXTENT&quot;</span><span class="p">,</span>
                                <span class="n">areaOfInterest</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                <span class="n">async</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The estimateExportTilesSize operation is an asynchronous task that</span>
<span class="sd">        allows estimation of the size of the tile package or the cache data</span>
<span class="sd">        set that you download using the Export Tiles operation. This</span>
<span class="sd">        operation can also be used to estimate the tile count in a tile</span>
<span class="sd">        package and determine if it will exceced the maxExportTileCount</span>
<span class="sd">        limit set by the administrator of the service. The result of this</span>
<span class="sd">        operation is Map Service Job. This job response contains reference</span>
<span class="sd">        to Map Service Result resource that returns the total size of the</span>
<span class="sd">        cache to be exported (in bytes) and the number of tiles that will</span>
<span class="sd">        be exported.</span>

<span class="sd">        Inputs:</span>

<span class="sd">        tilePackage - Allows estimating the size for either a tile package</span>
<span class="sd">         or a cache raster data set. Specify the value true for tile</span>
<span class="sd">         packages format and false for Cache Raster data set. The default</span>
<span class="sd">         value is False</span>
<span class="sd">           Values: True | False</span>
<span class="sd">        exportExtent - The extent (bounding box) of the tile package or the</span>
<span class="sd">         cache dataset to be exported. If extent does not include a spatial</span>
<span class="sd">         reference, the extent values are assumed to be in the spatial</span>
<span class="sd">         reference of the map. The default value is full extent of the</span>
<span class="sd">         tiled map service.</span>
<span class="sd">	   Syntax: &lt;xmin&gt;, &lt;ymin&gt;, &lt;xmax&gt;, &lt;ymax&gt;</span>
<span class="sd">           Example 1: -104,35.6,-94.32,41</span>
<span class="sd">        exportBy - The criteria that will be used to select the tile</span>
<span class="sd">         service levels to export. The values can be Level IDs, cache scales</span>
<span class="sd">         or the Resolution (in the case of image services).</span>
<span class="sd">	   Values: LevelID | Resolution | Scale</span>
<span class="sd">        levels - Specify the tiled service levels for which you want to get</span>
<span class="sd">         the estimates. The values should correspond to Level IDs, cache</span>
<span class="sd">         scales or the Resolution as specified in exportBy parameter. The</span>
<span class="sd">         values can be comma separated values or a range.</span>
<span class="sd">	   Example 1: 1,2,3,4,5,6,7,8,9</span>
<span class="sd">	   Example 2: 1-4,7-9</span>
<span class="sd">        areaOfInterest - (Optional) The areaOfInterest polygon allows</span>
<span class="sd">         exporting tiles within the specified polygon areas. This parameter</span>
<span class="sd">         supersedes exportExtent parameter. Also excepts geometry.Polygon.</span>
<span class="sd">	   Example: { &quot;features&quot;: [{&quot;geometry&quot;:{&quot;rings&quot;:[[[-100,35],</span>
<span class="sd">             [-100,45],[-90,45],[-90,35],[-100,35]]],</span>
<span class="sd">             &quot;spatialReference&quot;:{&quot;wkid&quot;:4326}}}]}</span>
<span class="sd">        async - (optional) the estimate function is run asynchronously</span>
<span class="sd">         requiring the tool status to be checked manually to force it to</span>
<span class="sd">         run synchronously the tool will check the status until the</span>
<span class="sd">         estimation completes.  The default is True, which means the status</span>
<span class="sd">         of the job and results need to be checked manually.  If the value</span>
<span class="sd">         is set to False, the function will wait until the task completes.</span>
<span class="sd">           Values: True | False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url</span> <span class="o">+</span> <span class="s2">&quot;/estimateExportTilesSize&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;f&quot;</span> <span class="p">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
            <span class="s2">&quot;levels&quot;</span> <span class="p">:</span> <span class="n">levels</span><span class="p">,</span>
            <span class="s2">&quot;exportBy&quot;</span> <span class="p">:</span> <span class="n">exportBy</span><span class="p">,</span>
            <span class="s2">&quot;tilePackage&quot;</span> <span class="p">:</span> <span class="n">tilePackage</span><span class="p">,</span>
            <span class="s2">&quot;exportExtent&quot;</span> <span class="p">:</span> <span class="n">exportExtent</span>
        <span class="p">}</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;levels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">levels</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">areaOfInterest</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">areaOfInterest</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">):</span>
                <span class="n">template</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">areaOfInterest</span><span class="o">.</span><span class="n">asDictionary</span><span class="p">]}</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;areaOfInterest&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">template</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;areaOfInterest&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">areaOfInterest</span>
        <span class="k">if</span> <span class="n">async</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
                                <span class="n">param_dict</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
                                <span class="n">securityHandler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_securityHandler</span><span class="p">,</span>
                                <span class="n">proxy_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_url</span><span class="p">,</span>
                                <span class="n">proxy_port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_port</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exportJob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
                                     <span class="n">param_dict</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
                                     <span class="n">securityHandler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_securityHandler</span><span class="p">,</span>
                                     <span class="n">proxy_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_url</span><span class="p">,</span>
                                     <span class="n">proxy_port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_port</span><span class="p">)</span>
            <span class="n">jobUrl</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/jobs/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">exportJob</span><span class="p">[</span><span class="s1">&#39;jobId&#39;</span><span class="p">])</span>
            <span class="n">gpJob</span> <span class="o">=</span> <span class="n">GPJob</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">jobUrl</span><span class="p">,</span>
                          <span class="n">securityHandler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_securityHandler</span><span class="p">,</span>
                          <span class="n">proxy_port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_port</span><span class="p">,</span>
                          <span class="n">proxy_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_url</span><span class="p">)</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">gpJob</span><span class="o">.</span><span class="n">jobStatus</span>
            <span class="k">while</span> <span class="n">status</span> <span class="o">!=</span> <span class="s2">&quot;esriJobSucceeded&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;esriJobFailed&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;esriJobCancelling&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;esriJobCancelled&#39;</span><span class="p">]:</span>
                    <span class="k">return</span> <span class="n">gpJob</span><span class="o">.</span><span class="n">messages</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                    <span class="n">status</span> <span class="o">=</span> <span class="n">gpJob</span><span class="o">.</span><span class="n">jobStatus</span>
            <span class="k">return</span> <span class="n">gpJob</span><span class="o">.</span><span class="n">results</span></div>
    <span class="c1">#----------------------------------------------------------------------</span>
<div class="viewcode-block" id="MapService.exportTiles"><a class="viewcode-back" href="../../../arcrest.ags.html#arcrest.ags.mapservice.MapService.exportTiles">[docs]</a>    <span class="k">def</span> <span class="nf">exportTiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">levels</span><span class="p">,</span>
                    <span class="n">exportBy</span><span class="o">=</span><span class="s2">&quot;LevelID&quot;</span><span class="p">,</span>
                    <span class="n">tilePackage</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                    <span class="n">exportExtent</span><span class="o">=</span><span class="s2">&quot;DEFAULT&quot;</span><span class="p">,</span>
                    <span class="n">optimizeTilesForSize</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                    <span class="n">compressionQuality</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">areaOfInterest</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                    <span class="n">async</span><span class="o">=</span><span class="bp">False</span>
                    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The exportTiles operation is performed as an asynchronous task and</span>
<span class="sd">        allows client applications to download map tiles from a server for</span>
<span class="sd">        offline use. This operation is performed on a Map Service that</span>
<span class="sd">        allows clients to export cache tiles. The result of this operation</span>
<span class="sd">        is Map Service Job. This job response contains a reference to the</span>
<span class="sd">        Map Service Result resource, which returns a URL to the resulting</span>
<span class="sd">        tile package (.tpk) or a cache raster dataset.</span>
<span class="sd">        exportTiles can be enabled in a service by using ArcGIS for Desktop</span>
<span class="sd">        or the ArcGIS Server Administrator Directory. In ArcGIS for Desktop</span>
<span class="sd">        make an admin or publisher connection to the server, go to service</span>
<span class="sd">        properties, and enable Allow Clients to Export Cache Tiles in the</span>
<span class="sd">        advanced caching page of the Service Editor. You can also specify</span>
<span class="sd">        the maximum tiles clients will be allowed to download. The default</span>
<span class="sd">        maximum allowed tile count is 100,000. To enable this capability</span>
<span class="sd">        using the Administrator Directory, edit the service, and set the</span>
<span class="sd">        properties exportTilesAllowed=true and maxExportTilesCount=100000.</span>

<span class="sd">        At 10.2.2 and later versions, exportTiles is supported as an</span>
<span class="sd">        operation of the Map Server. The use of the</span>
<span class="sd">        http://Map Service/exportTiles/submitJob operation is deprecated.</span>
<span class="sd">        You can provide arguments to the exportTiles operation as defined</span>
<span class="sd">        in the following parameters table:</span>

<span class="sd">        Inputs:</span>
<span class="sd">         exportBy - The criteria that will be used to select the tile</span>
<span class="sd">           service levels to export. The values can be Level IDs, cache</span>
<span class="sd">           scales. or the resolution (in the case of image services).</span>
<span class="sd">	   Values: LevelID | Resolution | Scale</span>
<span class="sd">        levels - Specifies the tiled service levels to export. The values</span>
<span class="sd">          should correspond to Level IDs, cache scales. or the resolution</span>
<span class="sd">          as specified in exportBy parameter. The values can be comma</span>
<span class="sd">          separated values or a range. Make sure tiles are present at the</span>
<span class="sd">          levels where you attempt to export tiles.</span>
<span class="sd">	   Example 1: 1,2,3,4,5,6,7,8,9</span>
<span class="sd">	   Example 2: 1-4,7-9</span>
<span class="sd">        tilePackage - Allows exporting either a tile package or a cache</span>
<span class="sd">          raster data set. If the value is true, output will be in tile</span>
<span class="sd">          package format, and if the value is false, a cache raster data</span>
<span class="sd">          set is returned. The default value is false</span>
<span class="sd">	   Values: true | false</span>
<span class="sd">        exportExtent - The extent (bounding box) of the tile package or the</span>
<span class="sd">          cache dataset to be exported. If extent does not include a</span>
<span class="sd">          spatial reference, the extent values are assumed to be in the</span>
<span class="sd">          spatial reference of the map. The default value is full extent of</span>
<span class="sd">          the tiled map service.</span>
<span class="sd">                       Syntax: &lt;xmin&gt;, &lt;ymin&gt;, &lt;xmax&gt;, &lt;ymax&gt;</span>
<span class="sd">                       Example 1: -104,35.6,-94.32,41</span>
<span class="sd">                       Example 2: {&quot;xmin&quot; : -109.55, &quot;ymin&quot; : 25.76,</span>
<span class="sd">                        &quot;xmax&quot; : -86.39, &quot;ymax&quot; : 49.94,</span>
<span class="sd">                        &quot;spatialReference&quot; : {&quot;wkid&quot; : 4326}}</span>
<span class="sd">        optimizeTilesForSize - (Optional) Use this parameter to enable</span>
<span class="sd">          compression of JPEG tiles and reduce the size of the downloaded</span>
<span class="sd">          tile package or the cache raster data set. Compressing tiles</span>
<span class="sd">          slightly compromises the quality of tiles but helps reduce the</span>
<span class="sd">          size of the download. Try sample compressions to determine the</span>
<span class="sd">          optimal compression before using this feature.</span>
<span class="sd">	   Values: true | false</span>
<span class="sd">        compressionQuality - (Optional) When optimizeTilesForSize=true, you</span>
<span class="sd">         can specify a compression factor. The value must be between 0 and</span>
<span class="sd">         100. The value cannot be greater than the default compression</span>
<span class="sd">         already set on the original tile. For example, if the default</span>
<span class="sd">         value is 75, the value of compressionQuality must be between 0 and</span>
<span class="sd">         75. A value greater than 75 in this example will attempt to up</span>
<span class="sd">         sample an already compressed tile and will further degrade the</span>
<span class="sd">         quality of tiles.</span>
<span class="sd">        areaOfInterest - (Optional) The areaOfInterest polygon allows</span>
<span class="sd">         exporting tiles within the specified polygon areas. This parameter</span>
<span class="sd">         supersedes the exportExtent parameter. Must be geometry.Polygon</span>
<span class="sd">         object.</span>
<span class="sd">        Example: { &quot;features&quot;: [{&quot;geometry&quot;:{&quot;rings&quot;:[[[-100,35],</span>
<span class="sd">         [-100,45],[-90,45],[-90,35],[-100,35]]],</span>
<span class="sd">         &quot;spatialReference&quot;:{&quot;wkid&quot;:4326}}}]}</span>
<span class="sd">        async - default True, this value ensures the returns are returned</span>
<span class="sd">         to the user instead of the user having the check the job status</span>
<span class="sd">         manually.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;f&quot;</span> <span class="p">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tilePackage&quot;</span> <span class="p">:</span> <span class="n">tilePackage</span><span class="p">,</span>
            <span class="s2">&quot;exportExtent&quot;</span> <span class="p">:</span> <span class="n">exportExtent</span><span class="p">,</span>
            <span class="s2">&quot;optimizeTilesForSize&quot;</span> <span class="p">:</span> <span class="n">optimizeTilesForSize</span><span class="p">,</span>
            <span class="s2">&quot;compressionQuality&quot;</span> <span class="p">:</span> <span class="n">compressionQuality</span><span class="p">,</span>
            <span class="s2">&quot;exportBy&quot;</span> <span class="p">:</span> <span class="n">exportBy</span><span class="p">,</span>
            <span class="s2">&quot;levels&quot;</span> <span class="p">:</span> <span class="n">levels</span>
        <span class="p">}</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url</span> <span class="o">+</span> <span class="s2">&quot;/exportTiles&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">areaOfInterest</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">):</span>
            <span class="n">geom</span> <span class="o">=</span> <span class="n">areaOfInterest</span><span class="o">.</span><span class="n">asDictionary</span><span class="p">()</span>
            <span class="n">template</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">geom</span><span class="p">]}</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;areaOfInterest&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">template</span>
        <span class="k">if</span> <span class="n">async</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">param_dict</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
                            <span class="n">proxy_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_url</span><span class="p">,</span>
                            <span class="n">proxy_port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_port</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exportJob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">param_dict</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
                                     <span class="n">securityHandler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_securityHandler</span><span class="p">,</span>
                                     <span class="n">proxy_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_url</span><span class="p">,</span>
                                     <span class="n">proxy_port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_port</span><span class="p">)</span>
            <span class="n">jobUrl</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/jobs/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">exportJob</span><span class="p">[</span><span class="s1">&#39;jobId&#39;</span><span class="p">])</span>
            <span class="n">gpJob</span> <span class="o">=</span> <span class="n">GPJob</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">jobUrl</span><span class="p">,</span>
                          <span class="n">securityHandler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_securityHandler</span><span class="p">,</span>
                          <span class="n">proxy_port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_port</span><span class="p">,</span>
                          <span class="n">proxy_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_url</span><span class="p">)</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">gpJob</span><span class="o">.</span><span class="n">jobStatus</span>
            <span class="k">while</span> <span class="n">status</span> <span class="o">!=</span> <span class="s2">&quot;esriJobSucceeded&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;esriJobFailed&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;esriJobCancelling&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;esriJobCancelled&#39;</span><span class="p">]:</span>
                    <span class="k">return</span> <span class="bp">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                    <span class="n">status</span> <span class="o">=</span> <span class="n">gpJob</span><span class="o">.</span><span class="n">jobStatus</span>
            <span class="n">allResults</span> <span class="o">=</span> <span class="n">gpJob</span><span class="o">.</span><span class="n">results</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">allResults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;out_service_url&quot;</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
                    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;f&quot;</span> <span class="p">:</span> <span class="s2">&quot;json&quot;</span>
                    <span class="p">}</span>
                    <span class="n">gpRes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>
                                         <span class="n">param_dict</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
                                         <span class="n">securityHandler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_securityHandler</span><span class="p">,</span>
                                         <span class="n">proxy_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_url</span><span class="p">,</span>
                                         <span class="n">proxy_port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_port</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">tilePackage</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
                        <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">gpRes</span><span class="p">[</span><span class="s1">&#39;files&#39;</span><span class="p">]:</span>
                            <span class="n">name</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
                            <span class="n">dlURL</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span>
                            <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">dlURL</span><span class="p">,</span>
                                          <span class="n">out_folder</span><span class="o">=</span><span class="n">tempfile</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">(),</span>
                                          <span class="n">file_name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                                          <span class="n">param_dict</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
                                          <span class="n">securityHandler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_securityHandler</span><span class="p">,</span>
                                          <span class="n">proxy_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_url</span><span class="p">,</span>
                                          <span class="n">proxy_port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proxy_port</span><span class="p">))</span>
                        <span class="k">return</span> <span class="n">files</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">gpRes</span><span class="p">[</span><span class="s1">&#39;folders&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">None</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">ArcREST 3.5.4 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2016, Esri.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
  </body>
</html>